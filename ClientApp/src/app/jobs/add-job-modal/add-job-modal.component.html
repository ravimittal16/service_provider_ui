<div class="modal-header">
  <h5 class="modal-title">Create Job</h5>
  <button
    type="button"
    class="close"
    aria-label="Close"
    (click)="activeModal.dismiss('Cross click')"
  >
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<form [formGroup]="jobFormGroup">
  <div class="modal-body">
    <app-error-view
      [errors$]="errors$"
      [observableDefined]="true"
    ></app-error-view>
    <div class="form-row">
      <div class="col-8">
        <div class="form-group flex-fill">
          <label>Customer*</label>
          <input
            id="typeahead-prevent-manual-entry"
            #titleInput
            type="text"
            class="form-control form-control-sm"
            [ngClass]="{ 'is-invalid': validationMessages.customerId }"
            formControlName="customerId"
            [ngbTypeahead]="searchCustomer"
            [inputFormatter]="formatter"
            [resultFormatter]="formatter"
            [editable]="false"
          />
          <!-- <select
            formControlName="customerId"
            choices=""
            [ngClass]="{ 'is-invalid': validationMessages.customerId }"
            (change)="onCustomerSelectionChanged()"
            class="form-control form-control-sm"
          >
            <option value="">Select Customer</option>
            <option *ngFor="let customer of activeCustomers$ | async"
              [value]="customer.id"
            >
              {{ customer.displayName }}
              <span *ngIf="customer.companyName"> -</span>
              {{ customer.companyName }}
            </option>
          </select> -->
          <div class="invalid-feedback" *ngIf="validationMessages.customerId">
            {{ validationMessages.customerId }}
          </div>
        </div>
      </div>
      <div class="col-1">
        <div class="d-flex justify-content-center mt-4">
          <span class="text-400">OR</span>
        </div>
      </div>
      <div class="col-3">
        <div class="form-group flex-fill">
          <div class="d-flex align-items-end">
            <button class="btn btn-falcon-default btn-block mt-4 btn-sm">
              <i class="fa fa-plus"></i>
              Create New
            </button>
          </div>
        </div>
      </div>
    </div>
    <div>
      <h5 class="modal-title text-400 fs-0">Job Information</h5>
    </div>
    <div class="form-row">
      <div class="col-8">
        <div class="form-group flex-fill">
          <label>Job Title*</label>
          <input
            type="text"
            formControlName="jobTitle"
            class="form-control form-control-sm"
            [ngClass]="{ 'is-invalid': validationMessages.jobTitle }"
            autofocus=""
          />
          <div class="invalid-feedback" *ngIf="validationMessages.jobTitle">
            {{ validationMessages.jobTitle }}
          </div>
        </div>
      </div>
      <div class="col-4">
        <div class="form-group flex-fill">
          <label>Job #</label>
          <input
            type="text"
            formControlName="jobNumber"
            class="form-control form-control-sm"
          />
          <small class="form-text text-muted">
            Auto populated if left blank.</small
          >
        </div>
      </div>
    </div>
    <div class="form-group flex-fill">
      <label>Service Type</label>
      <select
        formControlName="serviceTypeId"
        [ngClass]="{ 'is-invalid': validationMessages.serviceTypeId }"
        class="form-control form-control-sm"
      >
        <option value="">Select Service Type</option>
        <option
          *ngFor="let product of servicesOnly$ | async"
          [value]="product.productId"
        >
          {{ product.name }}
        </option>
      </select>
      <div class="invalid-feedback" *ngIf="validationMessages.serviceTypeId">
        {{ validationMessages.serviceTypeId }}
      </div>
    </div>
    <div class="form-group flex-fill">
      <label>Description</label>
      <textarea
        formControlName="jobDescription"
        rows="4"
        class="form-control form-control-sm"
      ></textarea>
    </div>

    <div class="mt-2">
      <h5 class="modal-title text-400 fs-0">
        <a
          class="form-section-link"
          data-toggle="collapse"
          href="#schedulePanel"
          role="button"
          aria-expanded="false"
          aria-controls="schedulePanel"
        >
          Schedule (optional)
        </a>
      </h5>
    </div>
    <div class="collapse" id="schedulePanel">
      <div class="form-group flex-fill">
        <label>Assign To</label>
        <select
          formControlName="assignedTo"
          class="form-control form-control-sm"
        ></select>
      </div>
      <div class="form-row">
        <div class="col-3">
          <div class="form-group flex-fill">
            <app-datetime-picker
              selectorType="date"
              formControlName="jobStartDate"
              title="Start Date"
              (onChanged)="onStartDateChanged($event)"
            ></app-datetime-picker>
          </div>
        </div>
        <div class="col-3">
          <div class="top-margin-4">
            <label class="sr-only">Start Date</label>
            <app-datetime-picker
              selectorType="time"
              formControlName="jobStartTime"
              [showTitle]="false"
              [combinedWithDate]="getFieldValue('jobStartDate')"
            ></app-datetime-picker>
          </div>
        </div>
        <div class="col-3">
          <div class="form-group flex-fill">
            <app-datetime-picker
              selectorType="date"
              formControlName="jobEndDate"
              title="End Date (Optional)"
            ></app-datetime-picker>
          </div>
        </div>
        <div class="col-3">
          <div class="top-margin-4">
            <label class="sr-only">Start Time</label>
            <app-datetime-picker
              selectorType="time"
              formControlName="jobEndTime"
              [showTitle]="false"
              [combinedWithDate]="getFieldValue('jobEndDate')"
            ></app-datetime-picker>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-2">
      <h5 class="modal-title text-400 fs-0">
        <a
          class="form-section-link"
          data-toggle="collapse"
          href="#internalNotesPanel"
          role="button"
          aria-expanded="false"
          aria-controls="internalNotesPanel"
        >
          Internal Notes (optional)
        </a>
      </h5>
    </div>
    <div class="form-row collapse" id="internalNotesPanel">
      <div class="col">
        <div class="form-group flex-fill">
          <label>Internal Notes</label>
          <textarea
            formControlName="internalNotes"
            rows="4"
            class="form-control form-control-sm"
          ></textarea>
          <small class="form-text text-muted">
            For internal use only. These notes will not included in any email or
            pdf.</small
          >
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <div class="col pr-0">
      <div class="float-right">
        <button
          type="button"
          class="btn btn-outline-dark btn-sm mr-1 mb-1"
          (click)="activeModal.close('Close click')"
        >
          Cancel
        </button>
        <button
          class="btn btn-primary btn-sm mr-1 mb-1"
          type="submit"
          (click)="onFormSubmitted(false)"
        >
          <span>Create</span>
        </button>
        <button
          class="btn btn-primary btn-sm mr-1 mb-1"
          type="submit"
          (click)="onFormSubmitted(true)"
        >
          <span>Create & Edit</span>
        </button>
      </div>
    </div>
  </div>
</form>
